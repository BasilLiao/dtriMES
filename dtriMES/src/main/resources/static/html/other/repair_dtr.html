<!-- 查詢項目 -->
<style>
.radio_size {
	width: 22px;
	height: 20px;
}

.datalist {
	overflow: hidden;
	text-overflow: ellipsis;
}

.datetimepicker {
	margin-top: 50px;
}

.fixed_cell {
	position: sticky;
	z-index: 5;
}

#rd_excel {
	border-collapse: separate;
	border-spacing: 0px;
	min-height: 450px;
}
</style>
<div id="customized">
	<!-- 客戶資料 & RAM 單據生成 -->
	<div class="shadow m-0 row">
		<div class="col-6 p-0 border border-secondary rounded-top">
			<div class="text-left bg-white rounded-top m-0 pl-1 h4">
				<div class="col p-0 pt-1">
					<i class="bi bi-house mr-1"></i>Customer Information
				</div>
			</div>
			<div class="m-0 p-2">
				<div id="c_c_name" class="col row m-0 mt-1 search_true">
					<div class="col-3">Company Name :</div>
					<input class="col-9 rounded border-1 border-primary" type="text" value="" placeholder="必填:客戶公司 (可查詢)">
				</div>
				<div id="c_name" class="col row m-0 mt-1 search_true">
					<div class="col-3">Contact :</div>
					<input class="col-9 rounded border-1 border-primary" type="text" value="" placeholder="客戶聯絡人 (可查詢)">
				</div>
				<div id="c_address" class="col row m-0 mt-1">
					<div class="col-3">Address :</div>
					<textarea class="col-9" rows="3" cols="" placeholder="客戶地址"></textarea>
				</div>
				<div id="c_tex" class="col row m-0 mt-1 search_true">
					<div class="col-3">Tex :</div>
					<input class="col-9 rounded border-1 border-primary" type="text" value="" placeholder="客戶電話 (可查詢)">
				</div>
				<div id="c_fax" class="col row m-0 mt-1">
					<div class="col-3">Fax :</div>
					<input class="col-9" type="text" value="" placeholder="客戶傳真">
				</div>
				<div id="fi_btn" class="col row m-0 mt-2 justify-content-end">
					<button id="clear_fi_btn" class="col-md-3  m-0 btn btn-warning btn-sm" type="button">Clear</button>
				</div>
			</div>
		</div>
		<div class="col-6 p-0 border border-secondary rounded-top">
			<div class="text-left bg-white rounded-top m-0 pl-1 h4">
				<div class="col p-0 pt-1">
					<i class="bi bi-gear mr-1"></i>Repair documents
				</div>
			</div>
			<div class="m-0 p-2">
				<div id="ro_id" class="col row m-0 mt-1 search_true">
					<div class="col-md-3">DTR NB :</div>
					<input class="col-md-9 rounded border-1 border-primary" type="text" value="" placeholder="維修單號 (新增請留白{可自動生成} or 可查詢)">
				</div>
				<div id="ro_address" class="col row m-0 mt-1">
					<div class="col-md-3">Ship back to :</div>
					<textarea disabled="disabled" class="col-md-9" rows="4" cols="" placeholder="DTR地址"></textarea>
				</div>
				<div id="ro_check" class="col row m-0 mt-1">
					<div class="col-md-3">Case closed? :</div>
					<select class="col-md-9" required="required">
						<option value="" class="def">請選擇</option>
					</select>
				</div>
				<div id="rd_ru_id" class="col row m-0 mt-1">
					<div class="col-md-3">To whom :</div>
					<div class="col-md-6 p-0 pr-2">
						<select class="col rounded  border-dark" required="required" style="border-width: 2px; height: 100%;">
							<option value="" class="def">請選擇</option>
						</select>
					</div>
					<div class="col-md-3 p-0">
						<button id="rd_designat_all_btn" class="col m-0 btn btn-dark btn-sm" type="button">All Def To whom</button>
					</div>
				</div>
				<div id="rd_check_only" class="col row m-0 mt-1">
					<div class="col-md-3">Status :</div>
					<div class="col-md-6 p-0 pr-2">
						<select class="col rounded  border-secondary" required="required" style="border-width: 2px; height: 100%;">
							<option value="" class="def">請選擇</option>
						</select>
					</div>
					<div class="col-md-3 p-0">
						<button id="rd_check_all_btn" class="col m-0 btn btn-secondary btn-sm" type="button">All Def Status</button>
					</div>
				</div>
				<div id="rd_btn" class="col row m-0 mt-2 justify-content-end">
					<button id="search_rd_btn" class="col-md-3 m-0 mr-2 btn btn-primary btn-sm" type="button">Search</button>
					<button id="clear_rd_btn" class="col-md-3  m-0 btn btn-warning btn-sm" type="button">Clear</button>
				</div>
			</div>
		</div>
	</div>

	<!-- 查詢結果 生產量 -->
	<div class="shadow mt-2  border border-secondary rounded-top">
		<div class="text-left bg-white rounded-top m-0 pl-1 h4 row">
			<div class="col-4 p-0 pt-1">
				<i class="bi bi-list-ul mr-1"></i>Repair list
			</div>
			<div class="col-8 p-0">
				<div class="row p-0 m-0 justify-content-end">
					<div class="col-md-2 pt-1">Action:</div>
					<div class="col-md-2 p-1">
						<button id="rd_export_btn" class="col m-0 btn btn-info btn-sm" type="button">Export excel</button>
					</div>
					<div class="col-md-2 p-1">
						<button id="rd_save_btn" class="col m-0 btn btn-success btn-sm" type="button">Save</button>
					</div>
					<div class="col-md-2 p-1">
						<button id="rd_clear_btn" class="col m-0 btn btn-warning btn-sm" type="button">Clear</button>
					</div>
				</div>
			</div>
		</div>
		<div class="p-2">
			<table id="rd_excel" class="table table-sm table-hover table-striped table-bordered table-responsive m-0">
				<thead class="thead bg-dark table-dark rd_search_example_title text-left" style="white-space: nowrap;">
					<tr class="d-none">
						<th colspan="13">.DTR Repair Order</th>
					</tr>
					<tr class="d-none">
						<th class="noExl">_</th>
						<th colspan="6">Company Name : <span id="excel_c_n"></span></th>
						<th colspan="7">DTR NB : <span id="excel_ro_id"></span></th>
					</tr>
					<tr class="d-none">
						<th class="noExl">_</th>
						<th colspan="6">Contact : <span id="excel_c"></span></th>
						<th colspan="7" rowspan="4">Ship back to : <span id="excel_sbt"></span></th>
					</tr>
					<tr class="d-none">
						<th class="noExl">_</th>
						<th colspan="6" rowspan="2">Address : <span id="excel_a"></span></th>
					</tr>
					<tr class="d-none">
						<th class="noExl">_</th>
					</tr>
					<tr class="d-none">
						<th class="noExl">_</th>
						<th colspan="6">Tex : <span id="excel_t"></span></th>
					</tr>
					<tr class="d-none">
						<th class="noExl">_</th>
						<th colspan="6">Fax : <span id="excel_f"></span></th>
						<th colspan="7">To whom : <span id="excel_tw"></span></th>
					</tr>
					<tr class="d-none">
						<th colspan="13">.</th>
					</tr>
					<tr class="">
						<th class="s_title_body noExl fixed_cell bg-dark" style="min-width: 100px; left: 1px">
							<div class="row p-0 m-0 justify-content-between">
								<div class="title_name">Function</div>
								<div class="title_order">
									<i class="bi bi-sort-alpha-down "></i>
									<!-- 分 -->
									<i class="bi bi-sort-alpha-up-alt d-none"></i>
								</div>
							</div>
						</th>
						<th class="s_title_last p-1" style="min-width: 150px; width: 100%;">
							<div class="row p-0 m-0 justify-content-between">
								<div class="title_name noExl">Handle</div>
								<div class="title_order">
									<i class="bi bi-sort-alpha-down "></i> <i class="bi bi-sort-alpha-up-alt d-none"></i>
								</div>
							</div>
						</th>
					</tr>
				</thead>
				<tbody class="rd_search_example_list" style="white-space: nowrap;">
					<tr class="noExl rd_search_example_content">
						<td title="" id="" class="s_function_body noExl fixed_cell" style="min-width: 100px; left: 1px; background-color: #ebecef"><i
							class="rd_list_add bi bi-plus-square btn btn-outline-success p-0 pl-1 pr-1"></i> <i class="rd_list_copy bi bi-files btn btn-outline-info p-0 pl-1 pr-1"></i> <i
							class="rd_list_del bi bi-x-square btn btn-outline-danger p-0 pl-1 pr-1"></i></td>
						<td title="" id="" class="s_list_body noExl">
							<div class="input_value">
								<input type="text" class="d_value col p-1 m-0" disabled="disabled" value="">
							</div>
							<div class="select_value d-none">
								<select class="d_value col p-1 m-0" disabled="disabled" style="border-width: 2px;">
									<option value="" class="def">請選擇</option>
								</select>
							</div>
						</td>
						<!-- Excel 匯出用 -->
						<td title="" id="" class="s_list_exl_body d-none">
							<div class="text_value d-none"></div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>
<script type="text/javascript">
//控制端
customized = new Vue({
	el: "#customized",
	//資料區
	data: {
		//換頁樣式
		page_total: main.page_total, //每次_總筆數
		page_batch: main.page_batch, //每次_第幾批

		page_show_size: main.page_show_size, //目前_每分頁顯示數量
		page_now_size: main.page_now_size, //目前_實際筆數
		page_now: main.page_now, //目前_頁數
		//data_type: "general", //資料: 一般模式(general) 父子群組模式(group)
		//data_item_f_id: "", //父類別ID
		//list_son:{},// 群組-子類別
		nb_add:0,//子項目
		//save data
		modify_datas :{},

	},
	//初始化
	created() {
		console.log("repair_dtr.html(created)");
	},
	//可呼叫方法
	methods: {
		setDataTitle(title,documents, html_permission) {
			//console.log(title);
			console.log(documents);
			//標題注入資訊
			//排序 
			title = main.orderedSort(title);
			fixed_cell = 101;
			
			for (var i = 0; i < Object.keys(title).length ; i++) {
				var one_item_header = $("#customized .rd_search_example_title .s_title_body").clone(); //複製樣本(header)
				var key_id = Object.keys(title)[i];
				var value_name = title[Object.keys(title)[i]].name;
				var value_size = title[Object.keys(title)[i]].size;
				var value_write = title[Object.keys(title)[i]].write;
				var key_name = key_id.split("_h__")[1];
				//console.log(key_name+" "+value_name);
				//header
				one_item_header[0].className = "p-1";
				one_item_header[0].id = key_id;
				one_item_header[0].children[0].children[0].innerText = value_name;
				one_item_header.insertBefore("#customized .s_title_last");
				$("#" + key_id).css("min-width", value_size);
				$("#" + key_id).css("max-width", value_size);
				//故定欄位
				if(i<4){
					$("#" + key_id).css("left", fixed_cell);
					$("#" + key_id).addClass("fixed_cell bg-dark");
				}
				$("#" + key_id).attr('title',value_write == "disabled" ? "disabled" : "");
				//body
				var one_item_exl_body = $("#customized .rd_search_example_content .s_list_exl_body").clone(); //複製樣本(body)
				one_item_exl_body = $(one_item_exl_body[0]);
				one_item_exl_body.removeClass("s_list_exl_body");
				one_item_exl_body.insertBefore("#customized .s_list_body");
				one_item_exl_body.addClass(key_name+"_exl");
				one_item_exl_body.insertBefore("#customized .s_list_body");
				
				var one_item_body = $("#customized .rd_search_example_content .s_list_body").clone(); //複製樣本(body)
				one_item_body = $(one_item_body[0]);
				one_item_body.addClass(key_name+" p-0");
				one_item_body.removeClass("s_list_body");
				one_item_body.find(".input_value input").attr("name",key_name);
				one_item_body.find(".input_value input").attr("title",(value_write == "disabled" ? "disabled" : ""));
				one_item_body.insertBefore("#customized .s_list_body");
				//故定欄位
				if(i<4){
					one_item_body.css("left", fixed_cell);
					one_item_body.css("background-color", "#ebecef");
					one_item_body.addClass("fixed_cell");
					fixed_cell+=parseInt(value_size);
				}
				
				//必填欄位(rr_sn)
				if(key_name=='rr_sn'){
					var css_must = ' rounded border-1 border-success ';
					one_item_body.find(".input_value input").addClass(css_must);
					one_item_body.find(".input_value input").attr("placeholder","必填:品件序號");
				}
				if(key_name=='rd_ru_id'){
					var css_must = ' rounded border-1 border-dark ';
					one_item_body.find(".select_value select").addClass(css_must);			
				}
				if(key_name=='rd_check'){
					var css_must = ' rounded border-1 border-secondary ';
					one_item_body.find(".select_value select").addClass(css_must);			
				}
				
				//特定數字類(input)
				if(documents[key_name]!=null && documents[key_name]=='number'){
					$('.'+key_name+' .d_value').attr("type","number");
					$('.'+key_name+' .d_value').val(1);
					$('.'+key_name+' .select_value').remove();
					continue;
				}
				
				//特定選項(select)
				if(documents[key_name]!=null){
					console.log(key_name);
					$('.'+key_name+' .input_value').remove();
					$('.'+key_name+' .select_value').removeClass('d-none');	
					$('.'+key_name+' .select_value select').attr('title',(value_write == "disabled" ? "disabled" : ""));
					$('.'+key_name+' .select_value select').attr('name',key_name);
					for(var o = 0;o< documents[key_name].length;o++){
						var option = $('.'+key_name+' .select_value select .def').clone(); //複製樣本(option)
						option[0].className = "";
						option[0].value = documents[key_name][o].key;
						option[0].innerText = documents[key_name][o].value; 
						option.appendTo('.'+key_name+' .select_value select');
					}
				}else{
					$('.'+key_name+' .select_value').remove();
				}
			}
			//功能選項顯示
			$('#customized .s_function_body .rd_list_add').attr("title","nb_example");
			$('#customized .s_function_body .rd_list_copy').addClass("d-none");
			$("#customized .s_function_body .rd_list_del").addClass("d-none");			
			//關閉範例
			$("#customized .s_title_last").addClass("d-none");
			$("#customized .s_list_body").addClass("d-none");
			$("#customized .s_list_body").addClass("noExl");

			//注入維修表單
			for(var d= 0;d < documents['rd_ru_id'].length;d++){
				var one_item = $("#rd_ru_id .def").clone(); //複製樣本
				one_item[0].className = "";
				one_item[0].innerText = documents['rd_ru_id'][d]['value'];
				one_item[0].value = documents['rd_ru_id'][d]['key'];
				one_item.appendTo("#rd_ru_id select");
			}
			//處理狀態
			for(var e= 0;e < documents['ro_check'].length;e++){
				var one_item = $("#ro_check .def").clone(); //複製樣本
				one_item[0].className = "";
				one_item[0].innerText = documents['ro_check'][e]['value'];
				one_item[0].value = documents['ro_check'][e]['key'];
				one_item.appendTo("#ro_check select");
			}
			//限制-處理狀態
			for(var e= 0;e < documents['rd_check_only'].length;e++){
				var one_item = $("#rd_check_only .def").clone(); //複製樣本
				one_item[0].className = "";
				one_item[0].innerText = documents['rd_check_only'][e]['value'];
				one_item[0].value = documents['rd_check_only'][e]['key'];
				one_item.appendTo("#rd_check_only select");
			}
			
			
			var ro_address = '美商定誼科技(股)公司台灣分公司 \n'+
			'1F. No.36 Wuquan 7th Rd. Wugu Dist.,\n'+
			'New Taipei City 24890 Taiwan (R.O.C.) \n'+
			'+886-2-22982203';
			$('#ro_address textarea').val(ro_address);
			
		},
		setDataList(list, list_son, body_type) {
			//清單注入[資訊,類型(可能是一般類型(清單)/父子類型(壓縮))] general/group
			console.log(list);
			var customer = list['customized_customer'];//客戶資料
			var documents = list['customized_orders'];//維修單據資料
			var customized = list['customized'];//維修單內容
			
			//注入 客戶
			$('#c_c_name input').val(customer['c_c_name']);
			$('#c_name input').val(customer['c_name']);
			$('#c_address textarea').val(customer['c_address']);
			$('#c_tex input').val(customer['c_tex']);
			$('#c_fax input').val(customer['c_fax']);
			//注入 單據資料
			$('#ro_check select').val(documents['ro_check']);
			$('#ro_id input').val(documents['ro_id']);
			//Excel 客戶
			$('#excel_c_n').text(customer['c_c_name']);
			$('#excel_c').text(customer['c_name']);
			$('#excel_a').text(customer['c_address']);
			$('#excel_t').text(customer['c_tex']);
			$('#excel_f').text(customer['c_fax']);
			//Excel 維修單
			$('#excel_ro_id').text(documents['ro_id']);
			$('#excel_sbt').text($('#ro_address textarea').val());
			
			
			//清除舊資料
			$(".detail_list").remove();
			//問題清單
			var ls_dp = list['customized_detail'];
			for (var j = 0; j < ls_dp.length; j++) {
				ls_dp[j] = main.orderedSort(ls_dp[j]);
				//資料筆數
				var list_item = $("#customized .rd_search_example_content").clone(); //複製樣本
				//===每筆 資料欄位===
				var fixed_cell_nb = 0;
				var fixed_cell_wh = 1;
				list_item[0].className="detail_list";
				list_item[0].id = "nb_"+j;
				//添加標記
				$(list_item[0]).find('.rd_list_add').attr('title',"nb_"+j);
				$(list_item[0]).find('.rd_list_copy').attr('title',"nb_"+j);
				$(list_item[0]).find('.rd_list_del').attr('title',"nb_"+j);
				
				$(list_item[0]).find('.rd_list_add').addClass('d-none');
				$(list_item[0]).find('.rd_list_copy').removeClass('d-none');
				$(list_item[0]).find('.rd_list_del').removeClass('d-none');
				for (var i = 0; i < Object.keys(ls_dp[j]).length; i++) {
					//取得title Size顯示
					var key = Object.keys(ls_dp[j])[i];
					var key_class = key.split("_b__")[1];
					var value =ls_dp[j][key];
					var v_text ='';
					var where = $(list_item[0]).find("."+key_class);
					var where_exl = $(list_item[0]).find("."+key_class+"_exl");
					//list_item[0].children[(i+1)].children[0].children[0].value = value;
					where.find(".d_value").val(value);
					where_exl.find(".text_value").text(value);
					//有可能是選項(select)

					if($('.rd_search_example_content .'+key_class+' select').length>0){
						v_text = $('.rd_search_example_content .'+key_class+' select option[value="'+value+'"]').text();
						where.find(".d_value").val(value+"");
						where_exl.find(".text_value").text(v_text);
					}
					//如果可修改 才修正disabled
					if(where.find(".d_value").attr("title")!='disabled'){
						where.find(".d_value").removeAttr("disabled");						
					}
				}
				$("#customized .rd_search_example_list").append(list_item);
			}
		},
		setSearch(search) {
			//查詢注入資訊
			console.log(search);
			if(search!=null){
				for (var i = 0; i < search.length; i++) {
					switch (search[i].tag) {
						case "input":
							var search_input = $("#customized .search_example_input").clone(); //複製樣本
							search_input[0].className = search[i].col + " p-2 search_true";
							search_input[0].id = "search_" + search[i].id;
							search_input.appendTo("#customized .search_example_finds");
							$("#" + search_input[0].id + " .s_name").text(search[i].name);
							//$("#" + search_input[0].id + " .s_value").val(search[i].value);
							//時間類型
							if (search[i].type == 'date') {
								$("#" + search_input[0].id + " .s_value").addClass('datetimepicker_date');
							}
							//預設
							if (search[i].value != "") {
								$("#" + search_input[0].id + " .s_value").attr("placeholder", search[i].value);
							}
							break;
						case "select":
							//查詢物件練立search:[{"id":"","values":[{"key":"XXX","value":"XXX"},{...}],"type":"","name":""}]
							//id / value / type
							var search_selsect = $("#customized .search_example_selsect").clone(); //複製樣本
							search_selsect[0].className = search[i].col + " p-2 search_true";
							search_selsect[0].id = "search_" + search[i].id;
							search_selsect.appendTo("#customized .search_example_finds");
							$("#" + search_selsect[0].id + " .s_name").text(search[i].name);
							for (var o = 0; o < search[i].values.length; o++) {
								var one_option = $("#customized #" + search_selsect[0].id + " select .example_select_one").clone(); //複製樣本
								one_option[0].id = "select_" + search[i]["values"][o]["key"];
								one_option[0].value = search[i]["values"][o]["key"];
								one_option[0].innerText = search[i]["values"][o]["value"];
								one_option[0].className = "";
								one_option.appendTo("#" + search_selsect[0].id + " select");
							}
							//關閉樣式
							break;
						default:
					}
					//關閉樣式
					$("#customized .example_select_one").addClass("d-none");
					$("#customized .search_example_input").addClass("d-none");
					$("#customized .search_example_selsect").addClass("d-none");
					main.loading(false);
				}
			}

			//時間格式
			$('#customized .datetimepicker_date').datetimepicker({
				format: 'yyyy-mm-dd hh:ii:00',
				pickerPosition: 'bottom-right',
				//minView:1,
				//hoursDisabled: [00, 1, 2, 3, 4, 5, 6, 7],
				minuteStep: 30,
				autoclose: true,
				endDate: '+1d',
				datesDisabled: '+1d',
				todayBtn: true,
				//......可以同上項目代碼自定義設置
			});
		},
		//初始化
		selectAllInit() {
			//查詢客戶 & 維修單
			$(document).on("click", "#search_rd_btn", function (event) {
				var search = {};
				search.c_c_name = 	$('#c_c_name input').val();
				search.c_name = 	$('#c_name input').val();
				search.c_address = 	$('#c_address textarea').val();
				search.c_tex = 		$('#c_tex input').val();
				search.c_fax = 		$('#c_fax input').val();
				search.ro_id = 		$('#ro_id input').val();
				customized.searchSend(search);
				
			});
			$(document).on("click", "#rd_export_btn", function (event) {
				console.log("rd_export_btn");
				//更新時間
				var myDate = new Date();
				var reportDate =
					myDate.getFullYear() + '-' +
					('0' + (myDate.getMonth() + 1)).slice(-2) + '-' +
					('0' + myDate.getDate()).slice(-2) + ' ' + myDate.getHours() + ':' +
					('0' + (myDate.getMinutes())).slice(-2) + ':' + myDate.getSeconds();
				$("#rd_excel").table2excel({
					// exclude CSS class
					//https://www.jqueryscript.net/table/Export-Html-Table-To-Excel-Spreadsheet-using-jQuery-table2excel.html
					preserveColors: false,
					exclude_img: true,
					exclude_links: true,
					exclude: ".noExl",
					name: "Worksheet Name",
					filename: "MES_Repair_Report_" + reportDate, //do not include extension
					fileext: ".xls" // file extension
				});
			});
			
			//清除客戶資料
			$(document).on("click", "#clear_fi_btn", function (event) {
				$('#c_c_name input').val("");
				$('#c_name input').val("");
				$('#c_address textarea').val("");
				$('#c_tex input').val("");
				$('#c_fax input').val("");
			});
			//清除維修單
			$(document).on("click", "#clear_rd_btn", function (event) {
				$('#ro_id input').val("");
				$('#rd_ru_id select').val("");
				$('#ro_check select').val("");
			});
			//清除問題敘述
			$(document).on("click", "#rd_clear_btn", function (event) {
				$('.detail_list').remove();
			});
			//預設分配單位
			$(document).on("click", "#rd_designat_all_btn", function (event) {
				var rd_ru_id =  $("#rd_ru_id select").val();
				$(".detail_list .rd_ru_id select").val(rd_ru_id).change();
			});
			//預設 處理狀態
			$(document).on("click", "#rd_check_all_btn", function (event) {
				var rd_check =  $("#rd_check_only select").val();
				//只有0 1 跟未選 可修改
				$(".detail_list .rd_check select").each(function() {
					if($(this).val()==null ||$(this).val()==0||$(this).val()==1){
						if($(this).val()==1 &&(rd_check==0 || rd_check==null)){
							console.log("不可倒退");
						}else{
							$(this).val(rd_check).change();							
						}
					}
				});
			});
			//存資料(可能:新增 可能修改)
			$(document).on("click","#rd_save_btn", function (event) {
				customized.sendSave();
			});
			//快速查詢 監聽確認
			$(document).on("keypress", "#customized .search_true input", function (event) {
				if (event.which == 13) {
					$('#search_rd_btn').trigger('click');
				}
			});
			//新增監聽
			$(document).on("click",".rd_list_add", function (event) {
				console.log("rd_list_add "+$(event.target).attr('title'));
				var clone_ex = $('.rd_search_example_content').clone();
				var nb_add = customized.nb_add;
				clone_ex[0].className ='detail_list';
				clone_ex[0].id = 'nb_add_'+nb_add;
				//功能
				$(clone_ex[0]).find('.rd_list_add').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_copy').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_del').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_add').addClass('d-none');
				$(clone_ex[0]).find('.rd_list_copy').removeClass('d-none');
				$(clone_ex[0]).find('.rd_list_del').removeClass('d-none');
				
				clone_ex.insertAfter('.rd_search_example_content');
				//可寫入?例遍
				$("#nb_add_"+nb_add+" td").each(function(){
					if($(this).find('.d_value').attr('title')=='disabled'){
						$(this).find('.d_value').attr('disabled','disabled');
					}else{
						$(this).find('.d_value').removeAttr('disabled');
					}
					//console.log(this);
				});
				customized.nb_add++;
				//添加標記
				
			});
			//複製監聽
			$(document).on("click",".rd_list_copy", function (event) {
				console.log("rd_list_copy "+$(event.target).attr('title'));
				var clone_ex = $('#'+$(event.target).attr('title')).clone();
				var nb_add = customized.nb_add;
				clone_ex[0].className ='detail_list';
				clone_ex[0].id = 'nb_add_'+nb_add;
				//功能
				$(clone_ex[0]).find('.rd_list_add').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_copy').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_del').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_add').addClass('d-none');
				$(clone_ex[0]).find('.rd_list_copy').removeClass('d-none');
				$(clone_ex[0]).find('.rd_list_del').removeClass('d-none');
				
				clone_ex.insertAfter('.rd_search_example_content');
				//第一格不可複製
				$('#nb_add_'+nb_add+' .rd_id input').val("");
				
				//欄位 例遍-> 可寫入?
				$("#nb_add_"+nb_add+" td").each(function(){
					if($(this).find('.d_value').attr('title')=='disabled'){
						$(this).find('.d_value').attr('disabled','disabled');
						//$(this).find('.d_value').val("");
					}else{
						$(this).find('.d_value').removeAttr('disabled');
					}
					//是Select 類型:原始的複製 目標
					if($(this).find("select").length>0 && $(this).find("select").attr('name')!=null){
						var tag_class = $(this).find("select").attr('name');
						var tag_val = $('#'+$(event.target).attr('title') +" ."+tag_class).find(":selected").val();
						//console.log(tag_class+" "+tag_val);
						//Status 除外
						if(tag_class!='rd_check'){
							$(this).find("select").val(tag_val);							
						}
					}
				});
				customized.nb_add++;
			});
			
			//移除監聽
			$(document).on("click",".rd_list_del", function (event) {
				console.log("rd_list_del "+$(event.target).attr('title'));
				$("#"+$(event.target).attr('title')).remove();
			});
		},
		//存檔
		sendSave() {
			console.log("sendSave");
			var modify_order = {};
			modify_order.c_c_name = 	$('#c_c_name input').val();
			modify_order.c_name = 		$('#c_name input').val();
			modify_order.c_address = 	$('#c_address textarea').val();
			modify_order.c_tex = 		$('#c_tex input').val();
			modify_order.c_fax = 		$('#c_fax input').val();
			modify_order.ro_id = 		$('#ro_id input').val();
			modify_order.ro_check = 	$('#ro_check select').val();
			
			var modify_detail=[];
			////////////
			for(var c = 0 ;c<$('.detail_list').length;c++){
				var id = $(".detail_list")[c].id;
				var modify_one={};
				for(var c_i =0 ;c_i <($("#"+id+" .d_value").length-2);c_i++){
					var key = $("#"+id+" .d_value")[c_i].name;
					var value = $("#"+id+" .d_value")[c_i].value;
					modify_one[key] = value;
				}
				modify_detail.push(modify_one);
			}
			this.modify_datas['detail'] = modify_detail;
			this.modify_datas['order'] = modify_order;
			console.log(this.modify_datas);
			
			var action = "S2";
			var	s_type = "PUT";
			var s_url = (t_body.html_body+"."+action).replace('html','basil').replace('body_','');
			var	s_data = {};
			var req = {};
			req.action=action;
			req.user=$('#name').text();
			req.date=new Date();
			req.body={};
			req.body['modify'] = this.modify_datas;
			req.page_total=this.page_total;
			req.page_batch=this.page_batch;
			req.page_now_nb=this.page_now_nb;
			req.html_body= "";
			req.call_bk_fn="customized";
			req.call_bk_vals={};
			req.call_bk_vals['search']=true;
			s_data.req_content = req;
			main.ajaxSend(s_url, s_type, s_data);
		},
		//search
		searchSend(search) {
			if(search==null){
				return null;
			}
			main.loading(true);
			//查詢
			//Ex:body:{search:{b:b,c:c}}
			//search = {};
			
			//包裝
			var action = "S1";
			var s_type = "POST";
			var s_url = (t_body.html_body + "."+action).replace("html", "basil").replace("body_", "");
			var s_data = {};
			var req = {};
			req.user = $('#name').text();
			req.date = new Date();
			req.action = action;
			req.body = {};
			req.body.search = search;
			req.page_total = this.page_total;
			req.page_batch = this.page_batch;
			req.page_now_nb = this.page_now_nb;
			req.html_body = "";
			req.call_bk_fn = "customized";
			req.call_bk_vals = {};
			req.call_bk_vals['search']=false;
			s_data.req_content = req;

			//console.log(s_url);
			//傳送
			main.ajaxSend(s_url, s_type, s_data);
		},
		searchReturn() {
			main.loading(false);
			console.log("searchReturn repair_dtr");

			//有可能沒有下一頁
			if (main.allData.body != null) {
				customized.setDataList(main.allData.body,
					main.allData.body.search_son,
					main.allData.body_type);				
			} 
			//可能是新建立
			if(main.allData.call_bk_vals.search){
				console.log(main.allData.call_bk_vals);
				$('#ro_id input').val(main.allData.call_bk_vals.ro_id);
				var search = {};
				search.c_c_name = 	$('#c_c_name input').val();
				search.c_name = 	$('#c_name input').val();
				search.c_address = 	$('#c_address textarea').val();
				search.c_tex = 		$('#c_tex input').val();
				search.c_fax = 		$('#c_fax input').val();
				search.ro_id = 		$('#ro_id input').val();
				customized.searchSend(search);
			}
		},
	},
	//移除監聽事件
	beforeDestroy() {
		console.log("repair_dtr.html(beforeDestroy)");
		$(document).off("click", "#export_btn");
		$(document).off("click", "#rd_export_btn");
		$(document).off("click", "#dwh_export_btn");
		$(document).off("click", "#dnoe_export_btn");
		
		$(document).off("click", "#search_rd_btn");
		$(document).off("click", "#clear_rd_btn");
		$(document).off("click", "#clear_fi_btn");
		$(document).off("click", "#rd_clear_btn");
		
		$(document).off("click", "#rd_save_btn");
		$(document).off("click", "#rd_designat_all_btn");
		$(document).off("click", "#rd_check_all_btn");
		
		$(document).off("click", ".rd_list_add");
		$(document).off("click", ".rd_list_copy");
		$(document).off("click", ".rd_list_del");

		$(document).off("keypress", "#customized .search_true input");
	},
});
</script>