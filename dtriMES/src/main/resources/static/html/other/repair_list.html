<!-- 查詢項目 -->
<style>
.radio_size {
	width: 22px;
	height: 20px;
}

.datalist {
	overflow: hidden;
	text-overflow: ellipsis;
}

.datetimepicker {
	margin-top: 50px;
}

.fixed_cell {
	position: sticky;
}

select {
	border-width: 2px;
}
</style>
<div id="customized">
	<!-- 維修處理 -->
	<div class="shadow m-0 row">
		<div class="col-12 p-0 border border-secondary rounded-top">
			<div class="text-left bg-white rounded-top m-0 pl-1 h4">
				<div class="col p-0 pt-1 pb-1">
					<i class="bi bi-tools mr-1"></i>Repair Information
				</div>
			</div>
			<div class="row p-0 m-0">
				<div class="col-md-6 m-0 p-2 text-left">
					<div class="col-md-12 p-1 m-0 search_true" id="rd_id">
						<div class="col p-0">維修單-項目(序號) :</div>
						<input class="col p-1 rounded border-1 border-primary detail_ri" type="text" value="" placeholder="維修單-項目Ex:DTR1659024000000-D000">
					</div>
					<!--  -->
					<div class="col-md-12 p-0 m-0 row">
						<div class="col-md-3 p-1 m-0 search_true" id="rr_sn">
							<div class="col p-0">產品(序號) :</div>
							<input class="col p-1 rounded border-1 border-primary detail_ri" type="text" value="" placeholder="產品Ex:58TW32225D227">
						</div>
						<div class="col-md-3 p-1 m-0" id="rr_pb_type">
							<div class="col p-0">物件類型 :</div>
							<select disabled class="col p-1 rounded detail_ri">
								<option class="def" value="">select(必填)</option>
							</select>
						</div>
						<div class="col-md-3 p-1 m-0" id="rr_pr_p_model">
							<div class="col p-0">產品型號 :</div>
							<input class="col p-1 rounded detail_ri" type="text" value="" disabled="disabled" placeholder="301,DT317...">
						</div>
						<div class="col-md-3 p-1 m-0" id="rr_f_ok">
							<div class="col p-0">產品狀態 :</div>
							<select disabled class="col p-1 rounded detail_ri">
								<option class="def" value="">select(必填)</option>
							</select>
						</div>

					</div>
					<!--  -->
					<div class="col-md-12 p-0 m-0 row">
						<div class="col-md-3 p-1 m-0" id="rr_v">
							<div class="col p-0">版本 :</div>
							<input class="col p-1 rounded detail_ri" type="text" value="" placeholder="料件/產品/主板 版本">
						</div>
						<div class="col-md-3 p-1 m-0" id="rd_rc_code">
							<div class="col p-0">處理代碼(轉) :</div>
							<input class="col p-1 rounded detail_ri" type="text" value="" placeholder="尚未支援功能">
						</div>
						<div class="col-md-3 p-1 m-0" id="rd_check">
							<div class="col p-0">處理問題(轉) :</div>
							<select class="col p-1 rounded detail_ri">
								<option class="def" value="">select(必填)</option>
							</select>
						</div>
						<div class="col-md-3 p-1 m-0" id="rd_ru_id">
							<div class="col p-0">處理單位(轉) :</div>
							<select class="col p-1 rounded detail_ri">
								<option class="def" value="">select(必填)</option>
							</select>
						</div>
					</div>
					<!--  -->
					<div class="col-md-12 p-1 m-0" id="sys_note">
						<div class="col p-0">紀錄備註 :</div>
						<input class="col p-1 rounded detail_ri" type="text" value="" placeholder="領/退料單/一些資訊(選填)">
					</div>
					<div class="col-md-12 p-1 m-0" id="rd_svg">
						<div class="col-md-12 p-0">
							<div class="">紀錄圖片 :</div>
							<div id="c_imgs_list" class="p-0 m-0 row ">
								<div class="col-2 p-1 rounded p-0 c_detail_imgs">
									<p class="save_ms_5pic d-none m-0 pl-1 small text-danger" style="bottom: 0px; z-index: 6; position: absolute;">最多五張圖</p>
									<p class="save_ms_atta d-none m-0 pl-1 small text-danger" style="bottom: 0px; z-index: 6; position: absolute;">副檔名錯誤</p>
									<p class="save_ms_bigger d-none m-0 pl-1 small text-danger" style="bottom: 0px; z-index: 6; position: absolute;">檔案太大</p>
									<p class="save_ms_put m-0 pl-1 small text-success" style="bottom: 0px; z-index: 6; position: absolute;">
										請放入圖片<br>(限制:2M/5Pic)
									</p>
									<input value="" class="col form-control p-1 c_chose_imgs" type="file" id="" accept=".png" style="height: 100%;" multiple>
								</div>
								<div class="col-2 p-1 pr-2 pl-2">
									<img class="col rounded p-0 pb-1 c_img_listen" alt="" src="./img/imgFrame.png">
									<!--  -->
									<input class="col p-0 pr-1 pl-1 border border-dark rounded d-none c_file_name" name="" value="檔案名稱?" type="text" disabled="disabled">
								</div>
								<div class="col-2 p-1 pr-2 pl-2">
									<img class="col rounded p-0 pb-1 c_img_listen" alt="" src="./img/imgFrame.png">
									<!--  -->
									<input class="col p-0 pr-1 pl-1 border border-dark rounded d-none c_file_name" name="" value="檔案名稱?" type="text" disabled="disabled">
								</div>
								<div class="col-2 p-1 pr-2 pl-2">
									<img class="col rounded p-0 pb-1 c_img_listen" alt="" src="./img/imgFrame.png">
									<!--  -->
									<input class="col p-0 pr-1 pl-1 border border-dark rounded d-none c_file_name" name="" value="檔案名稱?" type="text" disabled="disabled">
								</div>
								<div class="col-2 p-1 pr-2 pl-2">
									<img class="col rounded p-0 pb-1 c_img_listen" alt="" src="./img/imgFrame.png">
									<!--  -->
									<input class="col p-0 pr-1 pl-1 border border-dark rounded d-none c_file_name" name="" value="檔案名稱?" type="text" disabled="disabled">
								</div>
								<div class="col-2 p-1 pr-2 pl-2">
									<img class="col rounded p-0 pb-1 c_img_listen" alt="" src="./img/imgFrame.png">
									<!--  -->
									<input class="col p-0 pr-1 pl-1 border border-dark rounded d-none c_file_name" name="" value="檔案名稱?" type="text" disabled="disabled">
								</div>
								<!-- value:格式:[檔案名稱+'_'+檔案base64,檔案名稱+'_'+檔案base64,] -->
								<input alt="img" class="d-none c_save_value" disabled="disabled" value="[]">
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-6 m-0 p-2 text-left">
					<div class="col-md-12 m-0 p-1" id="rd_statement" style="height: 135px">
						<div class="col p-0">問題敘述 :</div>
						<textarea class="col rounded p-1 detail_ri" rows="4" cols="" placeholder="問題敘述(必填)" disabled="disabled"></textarea>
					</div>
					<div class="col-md-12 m-0 p-1" id="rd_true" style="height: 135px">
						<div class="col p-0">故障原因 :</div>
						<textarea class="col rounded p-1 detail_ri" rows="4" cols="" placeholder="故障原因(必填)"></textarea>
					</div>
					<div class="col-md-12 m-0 p-1" id="rd_experience" style="height: 135px">
						<div class="col p-0">維修心得 :</div>
						<textarea class="col rounded p-1 detail_ri" rows="4" cols="" placeholder="維修心得(選填)"></textarea>
					</div>
					<div class="col-md-12 m-0 p-1" id="">
						<div class="col p-0"></div>
					</div>
				</div>
				<div id="fi_btn" class="col p-1 row m-0 justify-content-end">
					<div class="col-md-1 p-1 m-0">
						<button id="search_fi_btn" class="col btn btn-primary btn-sm" type="button">Search</button>
					</div>
					<div class="col-md-1 p-1 m-0">
						<button id="clear_fi_btn" class="col btn btn-warning btn-sm" type="button">Clear</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 產品資訊 -->
	<div class="shadow mt-2  border border-secondary rounded-top">
		<div class="text-left bg-white rounded-top m-0 pl-1 h4">
			<div class="col p-0 pt-1 pb-1">
				<i class="bi bi-filter-square mr-1"></i>Project Content
			</div>
		</div>
		<div id="project_content" class="row p-0 m-0">
			<div class="col-md-12 row m-0 p-2 text-left">
				<div class="col-md-4 m-0 p-1" id="pr_b_item">
					<div class="col p-0">產品規格 :</div>
					<textarea class="col rounded p-1 detail_ri" rows="12" cols="" placeholder="暫無資料" disabled="disabled"></textarea>
				</div>
				<div class="col-md-4 m-0 p-1" id="pr_s_item">
					<div class="col p-0">軟體定義 :</div>
					<textarea class="col rounded p-1 detail_ri" rows="12" cols="" placeholder="暫無資料" disabled="disabled"></textarea>
				</div>
				<div class="col-md-4 m-0 p-1" id="pb_i_item">
					<div class="col p-0">零件內容 :</div>
					<textarea class="col rounded p-1 detail_ri" rows="12" cols="" placeholder="暫無資料" disabled="disabled"></textarea>
				</div>
			</div>
		</div>
	</div>

	<!-- 產品/配件 而外登記 -->
	<div class="shadow mt-2  border border-secondary rounded-top">
		<div class="text-left bg-white rounded-top m-0 pl-1 h4 row">
			<div class="col-6 p-0 pt-1 pb-1">
				<i class="bi bi-list-ul mr-1"></i>Part Repair
			</div>

			<div class=" col-6  row p-0 m-0 justify-content-end">
				<div class="col-md-2 pt-1">Action:</div>
				<div class="col-md-2 p-1 m-0">
					<button id="rd_save_btn" class="col m-0 btn btn-success btn-sm" type="button">Save</button>
				</div>
				<div class="col-md-2 p-1 m-0">
					<button id="rd_clear_btn" class="col m-0 btn btn-warning btn-sm" type="button">Clear</button>
				</div>
			</div>

		</div>
		<div id="part_repair" class="p-2">
			<table id="rd_excel" class="table table-sm table-hover table-striped table-bordered table-responsive m-0" style="min-height: 450px;">
				<thead class="thead bg-dark table-dark rd_search_example_title text-left" style="white-space: nowrap;">
					<tr class="">
						<th class="s_title_body noExl" style="min-width: 100px;">
							<div class="row p-0 m-0 justify-content-between">
								<div class="title_name">Function</div>
								<div class="title_order">
									<i class="bi bi-sort-alpha-down "></i>
									<!-- 分 -->
									<i class="bi bi-sort-alpha-up-alt d-none"></i>
								</div>
							</div>
						</th>
						<th class="s_title_last p-1" style="min-width: 150px; width: 100%;">
							<div class="row p-0 m-0 justify-content-between">
								<div class="title_name noExl">Handle</div>
								<div class="title_order">
									<i class="bi bi-sort-alpha-down "></i> <i class="bi bi-sort-alpha-up-alt d-none"></i>
								</div>
							</div>
						</th>
					</tr>
				</thead>
				<tbody class="rd_search_example_list" style="white-space: nowrap;">
					<tr class="noExl rd_search_example_content">
						<td title="" id="" class="s_function_body noExl"><i class="rd_list_add bi bi-plus-square btn btn-outline-success p-0 pl-1 pr-1"></i> <i
							class="rd_list_copy bi bi-files btn btn-outline-info p-0 pl-1 pr-1"></i> <i class="rd_list_del bi bi-x-square btn btn-outline-danger p-0 pl-1 pr-1"></i></td>
						<td title="" id="" class="s_list_body ">
							<div class="input_value">
								<input type="text" class="d_value col p-1 m-0" disabled="disabled" value="">
							</div>
							<div class="select_value d-none">
								<select class="d_value col p-1 m-0" disabled="disabled" style="border-width: 2px;">
									<option value="" class="def">請選擇</option>
								</select>
							</div>
							<div class="text_value d-none"></div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>
<script type="text/javascript">
//控制端
customized = new Vue({
	el: "#customized",
	//資料區
	data: {
		//換頁樣式
		page_total: main.page_total, //每次_總筆數
		page_batch: main.page_batch, //每次_第幾批

		page_show_size: main.page_show_size, //目前_每分頁顯示數量
		page_now_size: main.page_now_size, //目前_實際筆數
		page_now: main.page_now, //目前_頁數
		//data_type: "general", //資料: 一般模式(general) 父子群組模式(group)
		//data_item_f_id: "", //父類別ID
		//list_son:{},// 群組-子類別
		nb_add:0,//子項目
		//save data
		modify_datas :{},

	},
	//初始化
	created() {
		console.log("repair_list.html(created)");
	},
	//可呼叫方法
	methods: {
		setDataTitle(title,documents, html_permission) {
			//console.log(title);
			console.log(documents);
			//標題注入資訊
			//排序 
			title = main.orderedSort(title);
			fixed_cell = 0;
			for (var i = 0; i < Object.keys(title).length ; i++) {
				var one_item_header = $("#customized .rd_search_example_title .s_title_body").clone(); //複製樣本(header)
				var key_id = Object.keys(title)[i];
				var value_name = title[Object.keys(title)[i]].name;
				var value_size = title[Object.keys(title)[i]].size;
				var value_write = title[Object.keys(title)[i]].write;
				var key_name = key_id.split("_h__")[1];
				//console.log(key_name+" "+value_name);
				//header
				one_item_header[0].className = "p-1 ";
				one_item_header[0].id = key_id;
				one_item_header[0].children[0].children[0].innerText = value_name;
				one_item_header.insertBefore("#customized .s_title_last");
				$("#" + key_id).css("min-width", value_size);
				$("#" + key_id).css("max-width", value_size);
				$("#" + key_id).attr('title',value_write == "disabled" ? "disabled" : "");
				//body
				var one_item_exl_body = $("#customized .rd_search_example_content .s_list_exl_body").clone(); //複製樣本(body)
				one_item_exl_body = $(one_item_exl_body[0]);
				one_item_exl_body.removeClass("s_list_exl_body");
				one_item_exl_body.insertBefore("#customized .s_list_body");
				one_item_exl_body.addClass(key_name+"_exl");
				one_item_exl_body.insertBefore("#customized .s_list_body");
				
				var one_item_body = $("#customized .rd_search_example_content .s_list_body").clone(); //複製樣本(body)
				one_item_body = $(one_item_body[0]);
				one_item_body.addClass(key_name+" p-0");
				one_item_body.removeClass("s_list_body");
				one_item_body.find(".input_value input").attr("name",key_name);
				one_item_body.find(".input_value input").attr("title",(value_write == "disabled" ? "disabled" : ""));
				one_item_body.insertBefore("#customized .s_list_body");
				
				//必填欄位(rr_sn)
				if(key_name=='rr_sn'){
					var css_must = ' rounded border-1 border-success ';
					one_item_body.find(".input_value input").addClass(css_must);
					one_item_body.find(".input_value input").attr("placeholder","必填:品件序號");
				}
				if(key_name=='rd_ru_id'){
					var css_must = ' rounded border-1 border-dark ';
					one_item_body.find(".select_value select").addClass(css_must);			
				}
				if(key_name=='rd_check'){
					var css_must = ' rounded border-1 border-secondary ';
					one_item_body.find(".select_value select").addClass(css_must);			
				}
				
				//特定數字類(input)
				if(documents[key_name]!=null && documents[key_name]=='number'){
					$('.'+key_name+' .d_value').attr("type","number");
					$('.'+key_name+' .d_value').val(1);
					$('.'+key_name+' .select_value').remove();
					continue;
				}
				
				//特定選項(select)
				if(documents[key_name]!=null){
					console.log(key_name);
					$('.'+key_name+' .input_value').remove();
					$('.'+key_name+' .select_value').removeClass('d-none');	
					$('.'+key_name+' .select_value select').attr('title',(value_write == "disabled" ? "disabled" : ""));
					$('.'+key_name+' .select_value select').attr('name',key_name);
					for(var o = 0;o< documents[key_name].length;o++){
						var option = $('.'+key_name+' .select_value select .def').clone(); //複製樣本(option)
						option[0].className = "";
						option[0].value = documents[key_name][o].key;
						option[0].innerText = documents[key_name][o].value; 
						option.appendTo('.'+key_name+' .select_value select');
					}
				}else{
					$('.'+key_name+' .select_value').remove();
				}
			}
			//功能選項顯示
			$('#customized .s_function_body .rd_list_add').attr("title","nb_example");
			$('#customized .s_function_body .rd_list_copy').addClass("d-none");
			$("#customized .s_function_body .rd_list_del").addClass("d-none");			
			//關閉範例
			$("#customized .s_title_last").addClass("d-none");
			$("#customized .s_list_body").addClass("d-none");
			$("#customized .s_list_body").addClass("noExl");

			//注入維修表單
			for(var d= 0;d < documents['rd_ru_id'].length;d++){
				var one_item = $("#rd_ru_id .def").clone(); //複製樣本
				one_item[0].className = "";
				one_item[0].innerText = documents['rd_ru_id'][d]['value'];
				one_item[0].value = documents['rd_ru_id'][d]['key'];
				one_item.appendTo("#rd_ru_id select");
			}
			$("#rd_ru_id select").val("").change();
			//處理狀態
			for(var e= 0;e < documents['rd_check'].length;e++){
				var one_item = $("#rd_check .def").clone(); //複製樣本
				one_item[0].className = "";
				one_item[0].innerText = documents['rd_check'][e]['value'];
				one_item[0].value = documents['rd_check'][e]['key'];
				one_item.appendTo("#rd_check select");
			}
			$("#rd_check select").val("").change();
			
			//產品狀態
			for(var e= 0;e < documents['rr_f_ok'].length;e++){
				var one_item = $("#rr_f_ok .def").clone(); //複製樣本
				one_item[0].className = "";
				one_item[0].innerText = documents['rr_f_ok'][e]['value'];
				one_item[0].value = documents['rr_f_ok'][e]['key'];
				one_item.appendTo("#rr_f_ok select");
			}
			$("#rr_f_ok select").val("").change();
			//產品類型
			for(var e= 0;e < documents['rr_pb_type'].length;e++){
				var one_item = $("#rr_pb_type .def").clone(); //複製樣本
				one_item[0].className = "";
				one_item[0].innerText = documents['rr_pb_type'][e]['value'];
				one_item[0].value = documents['rr_pb_type'][e]['key'];
				one_item.appendTo("#rr_pb_type select");
			}
			$("#rr_pb_type select").val("").change();
			
			
		},
		setDataList(list, list_son, body_type) {
			//清單注入[資訊,類型(可能是一般類型(清單)/父子類型(壓縮))] general/group
			console.log(list);
			var documents = list['customized_detail'];//維修單據資料 
			
			//注入 單據資料
			$('#rd_ru_id select').val(documents['rd_ru_id']);
			$('#rd_id input').val(documents['rd_id']);
			$('#rr_sn input').val(documents['rr_sn']);
			$('#rr_pb_type select').val(documents['rr_pb_type']);
			$('#rr_pr_p_model input').val(documents['rr_pr_p_model']);
			$('#rr_v input').val(documents['rr_v']);
			$('#rr_f_ok select').val(documents['rr_f_ok']);
			$('#rd_statement textarea').val(documents['rd_statement']);
			$('#rd_true textarea').val(documents['rd_true']);
			$('#rd_experience textarea').val(documents['rd_experience']);
			$('#pr_b_item textarea').val(documents['pr_b_item']);
			$('#pr_s_item textarea').val(documents['pr_s_item']);
			$('#pb_i_item textarea').val(documents['pb_i_item']);
			
			$('#rd_svg .c_save_value').val(documents['rd_svg']);
			//僅限於Img
			 if (documents['rd_svg']!=null){
				 var imgs = $("#customized #rd_svg #c_imgs_list")[0];//圖片位置
				 console.log("img:");
				 var key_value = JSON.parse(documents['rd_svg']);
				 for(var j=0;j<key_value.length;j++){
					 var fileName = key_value[j]['fileName'];
					 var fileData = key_value[j]['fileData'];
					 $(imgs.children[(j+1)]).find('input').val(fileName);
					 $(imgs.children[(j+1)]).find('img').attr('src',fileData);
					 console.log(fileName);
				 }
			 }
			
			//如果有資料(上鎖)
			if(documents['rd_id']!=null){
				$('#rd_id input').attr("disabled","disabled");
				$('#rr_sn input').attr("disabled","disabled");
			}
			//清除舊資料
			$(".detail_list").remove();
			//問題清單
			var ls_dp = list['customized_detail'];
			for (var j = 0; j < ls_dp.length; j++) {
				ls_dp[j] = main.orderedSort(ls_dp[j]);
				//資料筆數
				var list_item = $("#customized .rd_search_example_content").clone(); //複製樣本
				//===每筆 資料欄位===
				var fixed_cell_nb = 0;
				var fixed_cell_wh = 1;
				list_item[0].className="detail_list";
				list_item[0].id = "nb_"+j;
				//添加標記
				$(list_item[0]).find('.rd_list_add').attr('title',"nb_"+j);
				$(list_item[0]).find('.rd_list_copy').attr('title',"nb_"+j);
				$(list_item[0]).find('.rd_list_del').attr('title',"nb_"+j);
				
				$(list_item[0]).find('.rd_list_add').addClass('d-none');
				$(list_item[0]).find('.rd_list_copy').removeClass('d-none');
				$(list_item[0]).find('.rd_list_del').removeClass('d-none');
				for (var i = 0; i < Object.keys(ls_dp[j]).length; i++) {
					//取得title Size顯示
					var key = Object.keys(ls_dp[j])[i];
					var key_class = key.split("_b__")[1];
					var value =ls_dp[j][key];
					var v_text ='';
					var where = $(list_item[0]).find("."+key_class);
					var where_exl = $(list_item[0]).find("."+key_class+"_exl");
					//list_item[0].children[(i+1)].children[0].children[0].value = value;
					where.find(".d_value").val(value);
					where_exl.find(".text_value").text(value);
					//有可能是選項(select)

					if($('.rd_search_example_content .'+key_class+' select').length>0){
						v_text = $('.rd_search_example_content .'+key_class+' select option[value="'+value+'"]').text();
						where.find(".d_value").val(value+"");
						where_exl.find(".text_value").text(v_text);
					}
					//如果可修改 才修正disabled
					if(where.find(".d_value").attr("title")!='disabled'){
						where.find(".d_value").removeAttr("disabled");						
					}
				}
				$("#customized .rd_search_example_list").append(list_item);
			}
		},
		setSearch(search) {
			//查詢注入資訊
			console.log(search);
			if(search!=null){
				for (var i = 0; i < search.length; i++) {
					switch (search[i].tag) {
						case "input":
							var search_input = $("#customized .search_example_input").clone(); //複製樣本
							search_input[0].className = search[i].col + " p-2 search_true";
							search_input[0].id = "search_" + search[i].id;
							search_input.appendTo("#customized .search_example_finds");
							$("#" + search_input[0].id + " .s_name").text(search[i].name);
							//$("#" + search_input[0].id + " .s_value").val(search[i].value);
							//時間類型
							if (search[i].type == 'date') {
								$("#" + search_input[0].id + " .s_value").addClass('datetimepicker_date');
							}
							//預設
							if (search[i].value != "") {
								$("#" + search_input[0].id + " .s_value").attr("placeholder", search[i].value);
							}
							break;
						case "select":
							//查詢物件練立search:[{"id":"","values":[{"key":"XXX","value":"XXX"},{...}],"type":"","name":""}]
							//id / value / type
							var search_selsect = $("#customized .search_example_selsect").clone(); //複製樣本
							search_selsect[0].className = search[i].col + " p-2 search_true";
							search_selsect[0].id = "search_" + search[i].id;
							search_selsect.appendTo("#customized .search_example_finds");
							$("#" + search_selsect[0].id + " .s_name").text(search[i].name);
							for (var o = 0; o < search[i].values.length; o++) {
								var one_option = $("#customized #" + search_selsect[0].id + " select .example_select_one").clone(); //複製樣本
								one_option[0].id = "select_" + search[i]["values"][o]["key"];
								one_option[0].value = search[i]["values"][o]["key"];
								one_option[0].innerText = search[i]["values"][o]["value"];
								one_option[0].className = "";
								one_option.appendTo("#" + search_selsect[0].id + " select");
							}
							//關閉樣式
							break;
						default:
					}
					//關閉樣式
					$("#customized .example_select_one").addClass("d-none");
					$("#customized .search_example_input").addClass("d-none");
					$("#customized .search_example_selsect").addClass("d-none");
					main.loading(false);
				}
			}

			//時間格式
			$('#customized .datetimepicker_date').datetimepicker({
				format: 'yyyy-mm-dd hh:ii:00',
				pickerPosition: 'bottom-right',
				//minView:1,
				//hoursDisabled: [00, 1, 2, 3, 4, 5, 6, 7],
				minuteStep: 30,
				autoclose: true,
				endDate: '+1d',
				datesDisabled: '+1d',
				todayBtn: true,
				//......可以同上項目代碼自定義設置
			});
		},
		//圖片處理
		file_reader_img(file,imgs){
			var reader = new FileReader();
			reader.readAsDataURL(file);
			reader.onload = function (e) {
				//顯示圖片位置
    			imgs[file.key].children[0].src = reader.result;
    			imgs[file.key].children[1].value = file.new_name;
    			//存入參數
    			var s =  JSON.parse(imgs[6].value);
    			var fileContent ={};
    			fileContent.fileName = file.new_name;
    			fileContent.fileData = reader.result;
    			s.push(fileContent);
    			imgs[6].value =JSON.stringify(s);
    			//console.log(imgs[6].value);
			};
			reader.onerror = function (error) {
				console.log('Error: ', error);
			};
		},
		//初始化
		selectAllInit() {
			//查詢客戶 & 維修單
			$(document).on("click", "#search_fi_btn", function (event) {
				//傳送
				var search = {};
				search.rd_id = 	$('#rd_id input').val();
				search.rr_sn = 	$('#rr_sn input').val();
				customized.searchSend(search);
			});
			
			//清除 維修資訊
			$(document).on("click", "#clear_fi_btn", function (event) {
				$('.detail_ri').val("");
				$('#rd_id input').removeAttr("disabled","");
				$('#rr_sn input').removeAttr("disabled","");
				$('#rd_svg div img').attr('src','./img/imgFrame.png');
			});
			//清除問題敘述
			$(document).on("click", "#rd_clear_btn", function (event) {
				$('.detail_list').remove("");
			});
			//存資料(可能:新增 可能修改)
			$(document).on("click","#rd_save_btn", function (event) {
				customized.sendSave();
			});
			//快速查詢 監聽確認
			$(document).on("keypress", "#customized .search_true input", function (event) {
				if (event.which == 13) {
					$('#search_fi_btn').trigger('click');
				}
			});
			//點擊圖片(預覽)
			 $(document).on("click", ".c_img_listen", function (event) {
        		 var image = new Image();
        	     image.src = event.target.src;
        		 var w = window.open("");
        	     w.document.write(image.outerHTML);
        	     w.document.close();
        	 });
        	 //圖片上傳資料
        	 $(document).on("change", ".c_chose_imgs", function (event) {
        		 console.log();
        		 //console.log(event);
        		 //console.log(event.currentTarget.files);
        		 var imgs =  $(this).parent().parent()[0].children;
        		 var imgs_def = $(this).parent().parent()[0];
        		 var imgs_ms = $(this).parent().parent()[0].children[0];

        		 var files = event.currentTarget.files;
        		 var file_size = 2000000;//限制2000000 = 2M
        		 var file_nb = 5;//限制 數量 5張圖
        		 $(imgs_ms).find('p').addClass("d-none");
        		 $(imgs_ms).find('.save_ms_put').removeClass("d-none");
        		 $(imgs_def).find('div img').attr('src','./img/imgFrame.png');
        		 $(imgs_def).find('div .c_file_name').val('檔案名稱?');
        		 imgs[6].value='[]';//預設內容
        		 //檢查機制
        		 if(files.length <= file_nb){
        			 for(var i=0;i<files.length;i++){
        				 var file_one = files[i];
        				 if(file_one.size > file_size){
        					 console.log('檔案太大');   
        					 $(imgs_ms).find('p').addClass("d-none");
        					 $(imgs_ms).find('.save_ms_bigger').removeClass("d-none");
        					 event.target.value = null;
        					 return false;
        				 }
        				 if(file_one.type!="image/png"){
        					 console.log('副檔錯誤');    
        					 $(imgs_ms).find('p').addClass("d-none");
        					 $(imgs_ms).find('.save_ms_atta').removeClass("d-none");
        					 event.target.value = null;
        					 return false;
        				 }
        			 }
        		 }else{
        			 console.log('檔案太多');  
        			 $(imgs_ms).find('p').addClass("d-none");
					 $(imgs_ms).find('.save_ms_5pic').removeClass("d-none");
        			 event.target.value = null;
        			 return false;
        		 }
        		 //解析檔案->顯示
        		 for(var i=0;i<files.length;i++){
        			 files[i].key = (i+1);
        			 files[i].new_name = 'MESimg'+(i+1)+'.png';
        			 customized.file_reader_img(files[i],imgs);
        		 }
        	});
			//新增監聽
			$(document).on("click",".rd_list_add", function (event) {
				console.log("rd_list_add "+$(event.target).attr('title'));
				var clone_ex = $('.rd_search_example_content').clone();
				var nb_add = customized.nb_add;
				clone_ex[0].className ='detail_list';
				clone_ex[0].id = 'nb_add_'+nb_add;
				//功能
				$(clone_ex[0]).find('.rd_list_add').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_copy').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_del').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_add').addClass('d-none');
				$(clone_ex[0]).find('.rd_list_copy').removeClass('d-none');
				$(clone_ex[0]).find('.rd_list_del').removeClass('d-none');
				
				clone_ex.insertAfter('.rd_search_example_content');
				//可寫入?例遍
				$("#nb_add_"+nb_add+" td").each(function(){
					if($(this).find('.d_value').attr('title')=='disabled'){
						$(this).find('.d_value').attr('disabled','disabled');
					}else{
						$(this).find('.d_value').removeAttr('disabled');
					}
					//console.log(this);
				});
				customized.nb_add++;
				//添加標記
				
			});
			//複製監聽
			$(document).on("click",".rd_list_copy", function (event) {
				console.log("rd_list_copy "+$(event.target).attr('title'));
				var clone_ex = $('#'+$(event.target).attr('title')).clone();
				var nb_add = customized.nb_add;
				clone_ex[0].className ='detail_list';
				clone_ex[0].id = 'nb_add_'+nb_add;
				//功能
				$(clone_ex[0]).find('.rd_list_add').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_copy').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_del').attr('title',"nb_add_"+nb_add);
				$(clone_ex[0]).find('.rd_list_add').addClass('d-none');
				$(clone_ex[0]).find('.rd_list_copy').removeClass('d-none');
				$(clone_ex[0]).find('.rd_list_del').removeClass('d-none');
				
				clone_ex.insertAfter('.rd_search_example_content');
				//第一格不可複製
				$('#nb_add_'+nb_add+' .rd_id input').val("");
				
				//欄位 例遍-> 可寫入?
				$("#nb_add_"+nb_add+" td").each(function(){
					if($(this).find('.d_value').attr('title')=='disabled'){
						$(this).find('.d_value').attr('disabled','disabled');
						//$(this).find('.d_value').val("");
					}else{
						$(this).find('.d_value').removeAttr('disabled');
					}
					//是Select 類型:原始的複製 目標
					if($(this).find("select").length>0 && $(this).find("select").attr('name')!=null){
						var tag_class = $(this).find("select").attr('name');
						var tag_val = $('#'+$(event.target).attr('title') +" ."+tag_class).find(":selected").val();
						//console.log(tag_class+" "+tag_val);
						//Status 除外
						if(tag_class!='rd_check'){
							$(this).find("select").val(tag_val);							
						}
					}
				});
				customized.nb_add++;
			});
			
			//移除監聽
			$(document).on("click",".rd_list_del", function (event) {
				console.log("rd_list_del "+$(event.target).attr('title'));
				$("#"+$(event.target).attr('title')).remove();
			});
			//產品資訊 關閉/開啟
			$(document).on("click", ".bi-filter-square", function (event) {
				console.log("bi .bi-filter-square");
				$("#project_content").slideToggle("fast");
			});
			//產品資訊 關閉/開啟
			$(document).on("click", ".bi-list-ul", function (event) {
				console.log("bi .bi-list-ul");
				$("#part_repair").slideToggle("fast");
			});
		},
		//存檔
		sendSave() {
			console.log("sendSave");
			var modify_repair = {};

			modify_repair['rd_ru_id'] =$('#rd_ru_id select').val();
			modify_repair['rd_id'] =$('#rd_id input').val();
			modify_repair['rr_sn'] =$('#rr_sn input').val();
			modify_repair['rr_pb_type'] =$('#rr_pb_type select').val();
			modify_repair['rr_pr_p_model'] =$('#rr_pr_p_model input').val();
			modify_repair['rr_v'] =$('#rr_v input').val();
			modify_repair['rr_f_ok'] =$('#rr_f_ok select').val();
			modify_repair['rd_statement'] =$('#rd_statement textarea').val();
			modify_repair['rd_true'] =$('#rd_true textarea').val();
			modify_repair['rd_experience'] =$('#rd_experience textarea').val();
			modify_repair['pr_b_item'] =$('#pr_b_item textarea').val();
			modify_repair['pr_s_item'] =$('#pr_s_item textarea').val();
			modify_repair['pb_i_item'] =$('#pb_i_item textarea').val(); 
			modify_repair['rd_svg'] =$('#rd_svg .c_save_value').val();
			modify_repair['rd_check'] =$('#rd_check .select').val();

			var modify_detail=[];
			////////////
			for(var c = 0 ;c<$('.detail_list').length;c++){
				var id = $(".detail_list")[c].id;
				var modify_one={};
				for(var c_i =0 ;c_i <($("#"+id+" .d_value").length-2);c_i++){
					var key = $("#"+id+" .d_value")[c_i].name;
					var value = $("#"+id+" .d_value")[c_i].value;
					modify_one[key] = value;
				}
				modify_detail.push(modify_one);
			}
			this.modify_datas['repair'] = modify_repair;
			this.modify_datas['detail'] = modify_detail;
			console.log(this.modify_datas);
			
			var action = "S2";
			var	s_type = "PUT";
			var s_url = (t_body.html_body+"."+action).replace('html','basil').replace('body_','');
			var	s_data = {};
			var req = {};
			req.action=action;
			req.user=$('#name').text();
			req.date=new Date();
			req.body={};
			req.body['modify'] = this.modify_datas;
			req.page_total=this.page_total;
			req.page_batch=this.page_batch;
			req.page_now_nb=this.page_now_nb;
			req.html_body= "";
			req.call_bk_fn="customized";
			req.call_bk_vals={};
			req.call_bk_vals['search']=true;
			s_data.req_content = req;
			main.ajaxSend(s_url, s_type, s_data);
		},
		//search
		searchSend(search) {
			if(search==null){
				return null;
			}
			main.loading(true);
			//查詢
			//Ex:body:{search:{b:b,c:c}}
			//search = {};
			
			//包裝
			var action = "S1";
			var s_type = "POST";
			var s_url = (t_body.html_body + "."+action).replace("html", "basil").replace("body_", "");
			var s_data = {};
			var req = {};
			req.user = $('#name').text();
			req.date = new Date();
			req.action = action;
			req.body = {};
			req.body.search = search;
			req.page_total = this.page_total;
			req.page_batch = this.page_batch;
			req.page_now_nb = this.page_now_nb;
			req.html_body = "";
			req.call_bk_fn = "customized";
			req.call_bk_vals = {};
			req.call_bk_vals['search']=false;
			s_data.req_content = req;

			//console.log(s_url);
			//傳送
			main.ajaxSend(s_url, s_type, s_data);
		},
		searchReturn() {
			main.loading(false);
			console.log("searchReturn repair_list");

			//有可能沒有下一頁
			if (main.allData.body != null) {
				customized.setDataList(main.allData.body,
					main.allData.body.search_son,
					main.allData.body_type);				
			} 
			//可能是新建立
			if(main.allData.call_bk_vals.search){
				console.log(main.allData.call_bk_vals);
				$('#rd_id input').val(main.allData.call_bk_vals.rd_id);
				$('#rr_sn input').val(main.allData.call_bk_vals.rr_sn);
				var search = {};
				search.rd_id = 	$('#rd_id input').val();
				search.rr_sn = 	$('#rr_sn input').val();
				customized.searchSend(search);
			}
		},
	},
	//移除監聽事件
	beforeDestroy() {
		console.log("repair_list.html(beforeDestroy)");
		$(document).off("click", "#search_fi_btn");
		$(document).off("click", "#clear_fi_btn");
		
		$(document).off("click", "#rd_clear_btn");
		$(document).off("click", "#rd_save_btn");
		
		$(document).off("click", ".rd_list_add");
		$(document).off("click", ".rd_list_copy");
		$(document).off("click", ".rd_list_del");
		$(document).off("click", ".c_img_listen");
		$(document).off("click", ".bi-filter-square");
		$(document).off("click", ".bi-list-ul");
		
		
		$(document).off("keypress", "#customized .search_true input");
	},
});
</script>